<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Refinance Comparison Tool</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: flex-start;
        }

        .form-container {
            width: 400px;
            padding: 20px;
        }

        .form-section {
            margin-bottom: 20px;
            padding: 15px;
            border-radius: 8px;
        }

        .subject-property {
            background-color: #f0f8ff;
        }

        .existing-mortgage {
            background-color: #e6ffe6;
        }

        .proposed-refinance {
            background-color: #ffe6e6;
        }

        .form-group {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        label {
            flex: 1;
            margin-right: 10px;
        }

        input, select {
            flex: 1;
            padding: 5px;
            font-size: 1em;
            width: 100px;
            text-align: right;
        }

        .comparison-results {
            margin-left: 20px;
            padding: 20px;
            background-color: #f9f9f9;
            border-radius: 8px;
            width: 500px;
        }

        h3 {
            margin-bottom: 10px;
        }

        .graph-container {
            margin-top: 20px;
            width: 100%;
            height: 300px;
        }
    </style>
</head>
<body>

    <div class="form-container">
        <h1>Refinance Comparison Tool</h1>
        
        <!-- Subject Property Section -->
        <div class="form-section subject-property">
            <h3>Subject Property</h3>
            <div class="form-group">
                <label for="borrowerName">Borrower Name:</label>
                <input type="text" id="borrowerName">
            </div>
            <div class="form-group">
                <label for="propertyID">Property ID:</label>
                <input type="text" id="propertyID">
            </div>
            <div class="form-group">
                <label for="currentValue">Current Value:</label>
                <input type="text" id="currentValue" oninput="formatCurrency(this)">
            </div>
            <div class="form-group">
                <label for="propertyTaxes">Current Property Taxes (Annual):</label>
                <input type="text" id="propertyTaxes" oninput="formatCurrency(this)">
            </div>
            <div class="form-group">
                <label for="homeownersInsurance">Current Homeowner's Insurance Premium (Annual):</label>
                <input type="text" id="homeownersInsurance" oninput="formatCurrency(this)">
            </div>
        </div>

        <!-- Existing Mortgage Section -->
        <div class="form-section existing-mortgage">
            <h3>Existing Mortgage</h3>
            <div class="form-group">
                <label for="purchaseDate">Date of Purchase:</label>
                <input type="date" id="purchaseDate">
            </div>
            <div class="form-group">
                <label for="purchasePrice">Purchase Price:</label>
                <input type="text" id="purchasePrice" oninput="formatCurrency(this)">
            </div>
            <div class="form-group">
                <label for="downPaymentPercent">Down Payment %:</label>
                <input type="text" id="downPaymentPercent" oninput="calculateDownPaymentPercent()">
            </div>
            <div class="form-group">
                <label for="downPaymentAmount">Down Payment $:</label>
                <input type="text" id="downPaymentAmount" oninput="calculateDownPaymentAmount()">
            </div>
            <div class="form-group">
                <label for="originalLoanAmount">Original Base Loan Amount:</label>
                <input type="text" id="originalLoanAmount" readonly>
            </div>
            <div class="form-group">
                <label for="interestRate">Original Interest Rate:</label>
                <input type="text" id="interestRate" oninput="formatPercentage(this)">
            </div>
            <div class="form-group">
                <label for="fhaLoan">FHA Loan:</label>
                <select id="fhaLoan" onchange="checkFhaLoan()">
                    <option value="no">NO</option>
                    <option value="yes">YES</option>
                </select>
            </div>
            <div class="form-group">
                <label for="mortgageInsuranceFactor">Mortgage Insurance Factor:</label>
                <input type="text" id="mortgageInsuranceFactor" readonly>
            </div>
        </div>

        <!-- Proposed Refinance Section -->
        <div class="form-section proposed-refinance">
            <h3>Proposed Refinance</h3>
            <div class="form-group">
                <label for="newLoanAmount">New Base Loan Amount:</label>
                <input type="text" id="newLoanAmount" readonly>
            </div>
            <div class="form-group">
                <label for="newInterestRate">New Interest Rate:</label>
                <input type="text" id="newInterestRate" oninput="formatPercentage(this)">
            </div>
        </div>
    </div>

    <div class="comparison-results">
        <h3>Loan Comparison Results</h3>
        <p>Existing Loan Monthly Payment: $0.00</p>
        <p>Proposed Refinance Monthly Payment: $0.00</p>
        <p>Monthly Savings: $0.00</p>
        <p>Break-even Point: 0 months</p>
        <p>Total Interest Paid: $0.00</p>

        <div class="graph-container">
            <canvas id="comparisonGraph"></canvas>
        </div>
    </div>

    <script>
        function formatCurrency(input) {
            let value = parseFloat(input.value.replace(/[^0-9.-]+/g,""));
            if (isNaN(value)) value = 0;
            input.value = "$" + value.toFixed(2);
        }

        function formatPercentage(input) {
            let value = parseFloat(input.value.replace(/[^0-9.-]+/g,""));
            if (isNaN(value)) value = 0;
            input.value = value.toFixed(2) + "%";
        }

        function calculateDownPaymentPercent() {
            let purchasePrice = parseFloat(document.getElementById('purchasePrice').value.replace(/[^0-9.-]+/g,""));
            let downPaymentAmount = parseFloat(document.getElementById('downPaymentAmount').value.replace(/[^0-9.-]+/g,""));
            if (purchasePrice && downPaymentAmount) {
                let percent = (downPaymentAmount / purchasePrice) * 100;
                document.getElementById('downPaymentPercent').value = percent.toFixed(2) + "%";
                calculateOriginalLoanAmount();
            }
        }

        function calculateDownPaymentAmount() {
            let purchasePrice = parseFloat(document.getElementById('purchasePrice').value.replace(/[^0-9.-]+/g,""));
            let downPaymentPercent = parseFloat(document.getElementById('downPaymentPercent').value.replace(/[^0-9.-]+/g,""));
            if (purchasePrice && downPaymentPercent) {
                let amount = (downPaymentPercent / 100) * purchasePrice;
                document.getElementById('downPaymentAmount').value = "$" + amount.toFixed(2);
                calculateOriginalLoanAmount();
            }
        }

        function calculateOriginalLoanAmount() {
            let purchasePrice = parseFloat(document.getElementById('purchasePrice').value.replace(/[^0-9.-]+/g,""));
            let downPaymentAmount = parseFloat(document.getElementById('downPaymentAmount').value.replace(/[^0-9.-]+/g,""));
            if (purchasePrice && downPaymentAmount) {
                let loanAmount = purchasePrice - downPaymentAmount;
                document.getElementById('originalLoanAmount').value = "$" + loanAmount.toFixed(2);
            }
        }

        function checkFhaLoan() {
            let fhaLoan = document.getElementById('fhaLoan').value;
            let purchaseDate = new Date(document.getElementById('purchaseDate').value);
            let march2023 = new Date("2023-03-01");

            if (fhaLoan === "yes") {
                if (purchaseDate < march2023) {
                    document.getElementById('mortgageInsuranceFactor').value = "0.85%";
                } else {
                    document.getElementById('mortgageInsuranceFactor').value = "0.55%";
                }
            } else {
                document.getElementById('mortgageInsuranceFactor').value = "";
            }
        }

    </script>

</body>
</html>
